#items
  ul
    li.item.active
      img src="https://secure.gravatar.com/avatar/2e7087b86608d4497c209eb9ba14d8f5?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-140.png"
      | 地図SDKは MapKit だけじゃない！OSMやBingが使える iOS用 Map SDK、route-me のセットアップ方法
    li.item
      img src="https://secure.gravatar.com/avatar/2e7087b86608d4497c209eb9ba14d8f5?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-140.png"
      | てすと
    li.item
      img src="https://secure.gravatar.com/avatar/2e7087b86608d4497c209eb9ba14d8f5?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-140.png"
      | てすと

#view
  article
    header
      h1 地図SDKは MapKit だけじゃない！OSMやBingが使える iOS用 Map SDK、route-me のセットアップ方法
    | <p>MapKit の有無を言わせない変更により自作アプリの地図がしょぼくなってしまったとお嘆きのデベロッパーのあなたにお送りします。自分の地図アプリが Apple 対 Google の争いに巻き込まれて影響を受けるなんて耐えられない！そう思いませんか？</p><p>route-me という SDK をご存知でしょうか。MapKitと同じような機能を提供するオープンソースのSDKです。現在のところ、 OpenStreetMap, Microsoft VirtualEarth, CloudMade, OpenAerialMap, OpenCycleMap, SpatialCloud などに対応しています。</p><p>この記事では、route-me の使い方を解説します。</p><h1>ライブラリのダウンロードとセットアップ</h1><p>早速 iOS でビルドしてみましょう。まずはソースコードをダウンロードしてきます。</p><div class="code-frame"><div class="code-lang"><span class="bold">Shell script, コマンド</span></div><div class="highlight"><pre>git clone https://github.com/route-me/route-me.git </pre></div></div><p>clone している間に、CloudMade のライセンスキーを取ってきましょう。<a href="http://cloudmade.com/register">http://cloudmade.com/register</a>からアカウントを取ると、APIキーが取得できます。<br>clone が終わったら、サンプルプロジェクトを適当なフォルダにコピーします。</p><div class="code-frame"><div class="code-lang"><span class="bold">Shell script, コマンド</span></div><div class="highlight"><pre>cp -rp samples/SampleMap/ ../your/awesome/mapproject </pre></div></div><p>プロジェクトファイルを開きます。</p><div class="code-frame"><div class="code-lang"><span class="bold">Shell script, コマンド</span></div><div class="highlight"><pre>open your/awesome/mapproject/SampleMap.xcodeproj/ </pre></div></div><p>Exampleフォルダ以下のプロジェクトからは相対パスでroute-meのライブラリにリンクがされている為、Exampleプロジェクトを別のフォルダに移すとリンクが壊れビルドできませんので、リンクを修正します。</p><ul><li>MapView.xcodeproj のリンク先を、route-me フォルダ配下のMapView.xcodeproj に指定しなおします。（XCode4 以降の場合、左のファイルインデックスから赤くなっている MapView.xcodeproj を選択した状態で右ペインの Utility を開き、Location 部分のアイコンをクリックすると変更できます。）</li><li>SampleMap の TARGETS を選択し、Build Phases からTarget Dependencies を開き、MapView を追加します。</li><li>Link Binary With Libraries を開き、libMapView.a を追加します。</li><li>Build Settings を開き、Header Search Paths を検索、../MapView/ となっているところを正しい位置に修正します。</li></ul><p>MainViewController.m の、CloudMade のライセンスキー部分を、先ほど取得したものに変更します。</p><div class="code-frame"><div class="code-lang"><span class="bold">MapViewController.m</span></div><div class="highlight"><pre><span class="kt">id</span><span class="n">myTilesource</span><span class="o">=</span><span class="p">[[[</span><span class="n">RMCloudMadeMapSource</span><span class="n">alloc</span><span class="p">]</span><span class="nl">initWithAccessKey:</span><span class="s">@"YOUR_API_KEY"</span><span class="nl">styleNumber:</span><span class="mi">999</span><span class="p">]</span><span class="n">autorelease</span><span class="p">];</span></pre></div></div><p>本来これで動くはずなのですが、私の場合ビルドすると RMCloudMadeMapSource.h が存在しないというエラーになってしまいました。<br>よく見ると MapView.xcodeproj/Map の中にRMCloudMadeMapSource 関連のファイルが入っていません。したがって Finder から、MapView/Map/以下にある RMCloudMadeMapSource.h と RMCloudMadeMapSource.m のファイルを XCode 上の MapView.xcodeproj/Map にドラッグドロップしたところ動くようになりました。</p><p><img src="https://dl.dropbox.com/u/442212/qiita/cloudmade1.png" alt="CloudMade" title="CloudMade"></p><p>移動やピンチイン、アウトでのズームなんかも問題なく動きます。</p><h1>デザインを変更する</h1><p>あれ、でもなんか画像が夜みたいになってますね。かっこいいけど地図としてはみにくいです。ちゃんとした地図を表示したいですね。CloudMade にはStyleEditor というものがあって、ユーザーが様々なスタイルを作ることが可能です。先ほどの</p><div class="code-frame"><div class="code-lang"><span class="bold">MapViewController.m</span></div><div class="highlight"><pre><span class="kt">id</span><span class="n">myTilesource</span><span class="o">=</span><span class="p">[[[</span><span class="n">RMCloudMadeMapSource</span><span class="n">alloc</span><span class="p">]</span><span class="nl">initWithAccessKey:</span><span class="s">@"YOUR_API_KEY"</span><span class="nl">styleNumber:</span><span class="mi">999</span><span class="p">]</span><span class="n">autorelease</span><span class="p">];</span></pre></div></div><p>の、styleNumber 部分が実はスタイルを指定しているのです。<br><a href="http://maps.cloudmade.com/editor">http://maps.cloudmade.com/editor</a>から、好きなスタイルを選んできましょう。<br><img src="https://dl.dropbox.com/u/442212/qiita/cloudmade_styles.png" alt="Styles" title="CloudMade Editor"><br>いっぱいありますね！ 右下の数字がStyleIDです。試しに997番を選んでみました。</p><div class="code-frame"><div class="code-lang"><span class="bold">MapViewController.m</span></div><div class="highlight"><pre><span class="kt">id</span><span class="n">myTilesource</span><span class="o">=</span><span class="p">[[[</span><span class="n">RMCloudMadeMapSource</span><span class="n">alloc</span><span class="p">]</span><span class="nl">initWithAccessKey:</span><span class="s">@"YOUR_API_KEY"</span><span class="nl">styleNumber:</span><span class="mi">997</span><span class="p">]</span><span class="n">autorelease</span><span class="p">];</span></pre></div></div><p>みごとスタイルが変更されました。やりましたね！<br><img src="https://dl.dropbox.com/u/442212/qiita/style-997.png" alt="変更された！" title="変更された地図"></p><p>CloudMade 以外の地図サービスの使い方も書こうと思ってたのですが、時間がなくなってきたので今日はこのへんで。</p>

